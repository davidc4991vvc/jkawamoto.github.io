!function(a){a.fn.poptrox_disableSelection=function(){return a(this).css("user-select","none").css("-khtml-user-select","none").css("-moz-user-select","none").css("-o-user-select","none").css("-webkit-user-select","none")},a.fn.poptrox=function(K){function F(){J=a(window).width(),G=a(window).height()+I.windowHeightPad;var f=Math.abs(A.width()-A.outerWidth()),d=Math.abs(A.height()-A.outerHeight()),b=(B.width(),B.height(),J-2*I.windowMargin-f),g=G-2*I.windowMargin-d;A.css("min-width",I.popupWidth).css("min-height",I.popupHeight),D.children().css("max-width",b).css("max-height",g)}if(0==this.length){return a(this)}if(this.length>1){for(var Q=0;Q<this.length;Q++){a(this[Q]).poptrox(K)}return a(this)}var J,G,I=a.extend({preload:!1,baseZIndex:1000,fadeSpeed:300,overlayColor:"#000000",overlayOpacity:0.6,overlayClass:"poptrox-overlay",windowMargin:50,windowHeightPad:0,selector:"a",caption:null,parent:"body",popupSpeed:300,popupWidth:200,popupHeight:100,popupIsFixed:!1,useBodyOverflow:!1,usePopupEasyClose:!0,usePopupForceClose:!1,usePopupLoader:!0,usePopupCloser:!0,usePopupCaption:!1,usePopupNav:!1,usePopupDefaultStyling:!0,popupBackgroundColor:"#FFFFFF",popupTextColor:"#000000",popupLoaderTextSize:"2em",popupCloserBackgroundColor:"#000000",popupCloserTextColor:"#FFFFFF",popupCloserTextSize:"20px",popupPadding:10,popupCaptionHeight:60,popupCaptionTextSize:null,popupBlankCaptionText:"(untitled)",popupCloserText:"&#215;",popupLoaderText:"&bull;&bull;&bull;&bull;",popupClass:"poptrox-popup",popupSelector:null,popupLoaderSelector:".loader",popupCloserSelector:".closer",popupCaptionSelector:".caption",popupNavPreviousSelector:".nav-previous",popupNavNextSelector:".nav-next",onPopupClose:null,onPopupOpen:null},K),L=a(this),Y=a("body"),N=a('<div class="'+I.overlayClass+'"></div>'),E=a(window),W=[],R=0,U=!1,V=new Array;I.usePopupLoader||(I.popupLoaderSelector=null),I.usePopupCloser||(I.popupCloserSelector=null),I.usePopupCaption||(I.popupCaptionSelector=null),I.usePopupNav||(I.popupNavPreviousSelector=null,I.popupNavNextSelector=null);var A;A=a(I.popupSelector?I.popupSelector:'<div class="'+I.popupClass+'">'+(I.popupLoaderSelector?'<div class="loader">'+I.popupLoaderText+"</div>":"")+'<div class="pic"></div>'+(I.popupCaptionSelector?'<div class="caption"></div>':"")+(I.popupCloserSelector?'<span class="closer">'+I.popupCloserText+"</span>":"")+(I.popupNavPreviousSelector?'<div class="nav-previous"></div>':"")+(I.popupNavNextSelector?'<div class="nav-next"></div>':"")+"</div>");var D=A.find(".pic"),B=a(),X=A.find(I.popupLoaderSelector),M=A.find(I.popupCaptionSelector),z=A.find(I.popupCloserSelector),j=A.find(I.popupNavNextSelector),H=A.find(I.popupNavPreviousSelector),q=j.add(H);if(I.usePopupDefaultStyling&&(A.css("background",I.popupBackgroundColor).css("color",I.popupTextColor).css("padding",I.popupPadding+"px"),M.length>0&&(A.css("padding-bottom",I.popupCaptionHeight+"px"),M.css("position","absolute").css("left","0").css("bottom","0").css("width","100%").css("text-align","center").css("height",I.popupCaptionHeight+"px").css("line-height",I.popupCaptionHeight+"px"),I.popupCaptionTextSize&&M.css("font-size",popupCaptionTextSize)),z.length>0&&z.html(I.popupCloserText).css("font-size",I.popupCloserTextSize).css("background",I.popupCloserBackgroundColor).css("color",I.popupCloserTextColor).css("display","block").css("width","40px").css("height","40px").css("line-height","40px").css("text-align","center").css("position","absolute").css("text-decoration","none").css("outline","0").css("top","0").css("right","-40px"),X.length>0&&X.html("").css("position","relative").css("font-size",I.popupLoaderTextSize).on("startSpinning",function(d){var b=a("<div>"+I.popupLoaderText+"</div>");b.css("height",Math.floor(I.popupHeight/2)+"px").css("overflow","hidden").css("line-height",Math.floor(I.popupHeight/2)+"px").css("text-align","center").css("margin-top",Math.floor((A.height()-b.height()+(M.length>0?M.height():0))/2)).css("color",I.popupTextColor?I.popupTextColor:"").on("xfin",function(){b.fadeTo(300,0.5,function(){b.trigger("xfout")})}).on("xfout",function(){b.fadeTo(300,0.05,function(){b.trigger("xfin")})}).trigger("xfin"),X.append(b)}).on("stopSpinning",function(b){var d=X.find("div");d.remove()}),2==q.length)){q.css("font-size","75px").css("text-align","center").css("color","#fff").css("text-shadow","none").css("height","100%").css("position","absolute").css("top","0").css("opacity","0.35").css("cursor","pointer").css("box-shadow","inset 0px 0px 10px 0px rgba(0,0,0,0)").poptrox_disableSelection();var O,e;I.usePopupEasyClose?(O="100px",e="100px"):(O="75%",e="25%"),j.css("right","0").css("width",O).html('<div style="position: absolute; height: 100px; width: 125px; top: 50%; right: 0; margin-top: -50px;">&gt;</div>'),H.css("left","0").css("width",e).html('<div style="position: absolute; height: 100px; width: 125px; top: 50%; left: 0; margin-top: -50px;">&lt;</div>')}return E.on("resize orientationchange",function(){F()}),M.on("update",function(b,d){d&&0!=d.length||(d=I.popupBlankCaptionText),M.html(d)}),z.css("cursor","pointer").on("click",function(b){return b.preventDefault(),b.stopPropagation(),A.trigger("poptrox_close"),!0}),j.on("click",function(b){b.stopPropagation(),b.preventDefault(),A.trigger("poptrox_next")}),H.on("click",function(b){b.stopPropagation(),b.preventDefault(),A.trigger("poptrox_previous")}),N.css("position","fixed").css("left",0).css("top",0).css("z-index",I.baseZIndex).css("width","100%").css("height","100%").css("text-align","center").css("cursor","pointer").appendTo(I.parent).prepend('<div style="display:inline-block;height:100%;vertical-align:middle;"></div>').append('<div style="position:absolute;left:0;top:0;width:100%;height:100%;background:'+I.overlayColor+";opacity:"+I.overlayOpacity+";filter:alpha(opacity="+100*I.overlayOpacity+');"></div>').hide().on("touchmove",function(b){return !1}).on("click",function(b){b.preventDefault(),b.stopPropagation(),A.trigger("poptrox_close")}),A.css("display","inline-block").css("vertical-align","middle").css("position","relative").css("z-index",1).css("cursor","auto").appendTo(N).hide().on("poptrox_next",function(){var b=R+1;b>=W.length&&(b=0),A.trigger("poptrox_switch",[b])}).on("poptrox_previous",function(){var b=R-1;0>b&&(b=W.length-1),A.trigger("poptrox_switch",[b])}).on("poptrox_reset",function(){F(),A.data("width",I.popupWidth).data("height",I.popupHeight),X.hide().trigger("stopSpinning"),M.hide(),z.hide(),q.hide(),D.hide(),B.attr("src","").detach()}).on("poptrox_open",function(b,d){return U?!0:(U=!0,I.useBodyOverflow&&Y.css("overflow","hidden"),I.onPopupOpen&&I.onPopupOpen(),void N.fadeTo(I.fadeSpeed,1,function(){A.trigger("poptrox_switch",[d,!0])}))}).on("poptrox_switch",function(h,d,g){var f;if(!g&&U){return !0}if(U=!0,A.css("width",A.data("width")).css("height",A.data("height")),M.hide(),B.attr("src")&&B.attr("src",""),B.detach(),f=W[d],B=f.object,B.off("load"),D.css("text-indent","-9999px").show().append(B),"ajax"==f.type?a.get(f.src,function(i){B.html(i),B.trigger("load")}):B.attr("src",f.src),"image"!=f.type){var k,b;k=f.width,b=f.height,"%"==k.slice(-1)&&(k=parseInt(k.substring(0,k.length-1))/100*E.width()),"%"==b.slice(-1)&&(b=parseInt(b.substring(0,b.length-1))/100*E.height()),B.css("position","relative").css("outline","0").css("z-index",I.baseZIndex+100).width(k).height(b)}X.trigger("startSpinning").fadeIn(300),A.show(),I.popupIsFixed?(A.width(I.popupWidth).height(I.popupHeight),B.load(function(){B.off("load"),X.hide().trigger("stopSpinning"),M.trigger("update",[f.captionText]).fadeIn(I.fadeSpeed),z.fadeIn(I.fadeSpeed),D.css("text-indent",0).hide().fadeIn(I.fadeSpeed,function(){U=!1}),R=d,q.fadeIn(I.fadeSpeed)})):B.load(function(){F(),B.off("load"),X.hide().trigger("stopSpinning");var l=B.width(),m=B.height(),i=function(){M.trigger("update",[f.captionText]).fadeIn(I.fadeSpeed),z.fadeIn(I.fadeSpeed),D.css("text-indent",0).hide().fadeIn(I.fadeSpeed,function(){U=!1}),R=d,q.fadeIn(I.fadeSpeed),A.data("width",l).data("height",m).css("width","auto").css("height","auto")};l==A.data("width")&&m==A.data("height")?i():A.animate({width:l,height:m},I.popupSpeed,"swing",i)}),"image"!=f.type&&B.trigger("load")}).on("poptrox_close",function(){return U&&!I.usePopupForceClose?!0:(U=!0,A.hide().trigger("poptrox_reset"),I.onPopupClose&&I.onPopupClose(),void N.fadeOut(I.fadeSpeed,function(){I.useBodyOverflow&&Y.css("overflow","auto"),U=!1}))}).trigger("poptrox_reset"),I.usePopupEasyClose?(M.on("click","a",function(b){b.stopPropagation()}),A.css("cursor","pointer").on("click",function(b){b.stopPropagation(),b.preventDefault(),A.trigger("poptrox_close")})):A.on("click",function(b){b.stopPropagation()}),E.keydown(function(b){if(A.is(":visible")){switch(b.keyCode){case 37:case 32:if(I.usePopupNav){return A.trigger("poptrox_previous"),!1}break;case 39:if(I.usePopupNav){return A.trigger("poptrox_next"),!1}break;case 27:return A.trigger("poptrox_close"),!1}}}),L.find(I.selector).each(function(m){var g,f,k=a(this),h=k.find("img"),r=k.data("poptrox");if("ignore"!=r&&k.attr("href")){if(g={src:k.attr("href"),captionText:h.attr("title"),width:null,height:null,type:null,object:null,options:null},I.caption){if("function"==typeof I.caption){c=I.caption(k)}else{if("selector" in I.caption){var d;d=k.find(I.caption.selector),"attribute" in I.caption?c=d.attr(I.caption.attribute):(c=d.html(),I.caption.remove===!0&&d.remove())}}}else{c=h.attr("title")}if(g.captionText=c,r){var b=r.split(",");0 in b&&(g.type=b[0]),1 in b&&(f=b[1].match(/([0-9%]+)x([0-9%]+)/),f&&3==f.length&&(g.width=f[1],g.height=f[2])),2 in b&&(g.options=b[2])}if(!g.type){switch(f=g.src.match(/\/\/([a-z0-9\.]+)\/.*/),(!f||f.length<2)&&(f=[!1]),f[1]){case"api.soundcloud.com":g.type="soundcloud";break;case"youtu.be":g.type="youtube";break;case"vimeo.com":g.type="vimeo";break;case"wistia.net":g.type="wistia";break;case"bcove.me":g.type="bcove";break;default:g.type="image"}}switch(f=g.src.match(/\/\/[a-z0-9\.]+\/(.*)/),g.type){case"iframe":g.object=a('<iframe src="" frameborder="0"></iframe>'),g.object.on("click",function(i){i.stopPropagation()}).css("cursor","auto"),g.width&&g.height||(g.width="600",g.height="400");break;case"ajax":g.object=a('<div class="poptrox-ajax"></div>'),g.object.on("click",function(i){i.stopPropagation()}).css("cursor","auto").css("overflow","auto"),g.width&&g.height||(g.width="600",g.height="400");break;case"soundcloud":g.object=a('<iframe scrolling="no" frameborder="no" src=""></iframe>'),g.src="//w.soundcloud.com/player/?url="+escape(g.src)+(g.options?"&"+g.options:""),g.width="600",g.height="166";break;case"youtube":g.object=a('<iframe src="" frameborder="0" allowfullscreen="1"></iframe>'),g.src="//www.youtube.com/embed/"+f[1]+(g.options?"?"+g.options:""),g.width&&g.height||(g.width="800",g.height="480");break;case"vimeo":g.object=a('<iframe src="" frameborder="0" allowFullScreen="1"></iframe>'),g.src="//player.vimeo.com/video/"+f[1]+(g.options?"?"+g.options:""),g.width&&g.height||(g.width="800",g.height="480");break;case"wistia":g.object=a('<iframe src="" frameborder="0" allowFullScreen="1"></iframe>'),g.src="//fast.wistia.net/"+f[1]+(g.options?"?"+g.options:""),g.width&&g.height||(g.width="800",g.height="480");break;case"bcove":g.object=a('<iframe src="" frameborder="0" allowFullScreen="1" width="100%"></iframe>'),g.src="//bcove.me/"+f[1]+(g.options?"?"+g.options:""),g.width&&g.height||(g.width="640",g.height="360");break;default:if(g.object=a('<img src="" alt="" style="vertical-align:bottom" />'),I.preload){var f=document.createElement("img");f.src=g.src,V.push(f)}g.width=k.attr("width"),g.height=k.attr("height")}"file:"==window.location.protocol&&g.src.match(/^\/\//)&&(g.src="http:"+g.src),W.push(g),h.attr("title",""),k.attr("href","").css("outline",0).on("click",function(i){i.preventDefault(),i.stopPropagation(),A.trigger("poptrox_open",[m])})}}),a(this)}}(jQuery);